## iOS加固目的

iOS加固的主要目的如下：
1. 增加外挂作者对游戏逻辑的分析成本；
2. 增加通过静态修改安装包，生成破解版的难度。

## iOS加固功能介绍

### global-metadata加密

由于Unity游戏引擎的特性，il2cpp会在编译时将游戏主逻辑的所有符号全部保存在发布版的安装包中。对于⼀个未加保护的il2cpp游戏，外挂作者可以通过"[Il2CppDumper](https://github.com/Perfare/Il2CppDumper)"或者类似的⼯具直接获得游戏的所有符号信息，这对于⼀个有经验的外挂作者来说⽆异于得到游戏源码。 ⽽global-metadata.dat⽂件是il2cpp这些符号⽂件的索引，也是外挂作者得到游戏符号的钥匙。对global-metadata.dat⽂件进⾏加密可以有效增加外挂作者获取到游戏符号的难度。<br/>
⽬前Android加固已有对global-metadata.dat⽂件的加密，但是由于⼤多数il2cpp游戏的Android与IOS使⽤同⼀份源码编译，如果iOS版本未进⾏保护，那么外挂作者通过游戏的IOS版本获取到游戏符号，⼀样可以得到游戏符号信息，这些信息对于作者加深对游戏的了解也有很⼤帮助。<br/>
下图展示的是IOS加固前对于il2cpp游戏的符号解析结果: 使⽤用Il2CppDumper，输⼊入如下命令进⾏行行符号解析：

```bash
Il2CppDumper.exe <main-binary-path> <global-metadata-path>
```
然后输⼊Unity的版本与使⽤Auto模式进⾏解析

![ ](/docs/ACE-doc/30_iOS-shellservice/10/7.png)

得到dump.cs⽂件

![ ](/docs/ACE-doc/30_iOS-shellservice/10/8.png)

其中ClockAnimator就是我们示例游戏的主逻辑所在的类，该类的类名与⽅法名、成员变量名都被解析出来了。<br/>
在进⾏IOS加固之后，再次尝试使⽤[Il2CppDumper](https://github.com/Perfare/Il2CppDumper)进⾏解析, 发现Il2CppDumper⽆法识别加密后的global-metadata.dat

![ ](/docs/ACE-doc/30_iOS-shellservice/10/9.png)

### 资源文件校验

iOS加固一个重要的作⽤是防⽌安装包内文件被修改与重打包。 目前iOS加固工具需要和[反外挂SDK](#/tool-center)(4.8版本以上)一起使⽤才能获得资源文件校验功能。 只需要对已经接了反外挂SDK的iOS应用加固即可检测应⽤用安装包内文件是否正常,并在检测到文件修改与删除时进行行闪退。

## iOS加固前后性能对比

加固对性能的影响与游戏主逻辑⼆进制模块⼤小和游戏类型有关，并且iOS加固只对游戏启动时间略有影响，在游戏过程中没有代码运行，所以不会影响游戏过程的性能。
<br/>
以下加固性能是使用内部demo游戏进行测试，除启动时间外均取自正常游戏过程中运行时平均值。

| 时间 | 启动时间 | 内存占用 | 整包体积 |
| ---- | ---- | ----- | -----|
| 加固前 | 0.32/0.67ms | 5MB | 1.33MB |
| 加固后 | 0.33/0.69ms | 5MB | 1.37MB |

可以看出，加固前后，游戏整体的性能与体积不会发生太大变化。
